<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>CloudPlugin by dorugucea91</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">CloudPlugin</h1>
      <h2 class="project-tagline">Cloud Services Plugin for ImageJ - Gsoc 2015</h2>
      <a href="https://github.com/dorugucea91/CloudPlugin" class="btn">View on GitHub</a>
      <a href="https://github.com/dorugucea91/CloudPlugin/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/dorugucea91/CloudPlugin/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="developers" class="anchor" href="#developers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Developers</h1>

<p>Student: <a href="gucea.doru@gmail.com">Doru-Cristian Gucea</a><br>
Mentor1: <a href="dimiterpp@gmail.com">Dimiter Prodanov</a><br>
Mentor2: <a href="visakh@incf.org">Visakh Muraleedharan</a>   </p>

<h1>
<a id="organization" class="anchor" href="#organization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Organization:</h1>

<p><a href="http://incf.org">International Neuroinformatics Coordinating Facility</a>   </p>

<h1>
<a id="project-description" class="anchor" href="#project-description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project description</h1>

<p>ImageJ is a public domain Java image processing program designed with an open architecture that provides extensibility via Java plugins. The aim of this project is to develop an ImageJ plugin which can be used to download/upload datasets from/to iRODS (Integrated Rule-Oriented Data System), an open source data management software used by the research community in order to take control of their data, regardless of where and on what device the data is stored</p>

<h3>
<a id="re-factoring" class="anchor" href="#re-factoring" aria-hidden="true"><span class="octicon octicon-link"></span></a>Re-factoring</h3>

<p>My project is forked from Atin's repository: <a href="https://github.com/Atin007/dbclient">https://github.com/Atin007/dbclient</a>, which is a GSoc 2014 project. Atin's project implements an ImageJ plugin for Dropbox, so I thought that it would be appropriate to integrate my new iRODS functionality as another cloud service.<br>
A lot of re-factoring was done to the old project in order to make it clear and easier to support for future developers. The problems with the coding style from the Gsoc 2014's project was that (quote from the project proposal belonging to Desmond, Joshua A.): </p>

<blockquote>
<p>The current project is nothing short of a mess, with a thorough lack of documentation, an
absence of automated JUnit tests, and a strong disregard for object oriented design principles. The
program admittedly works as it should, but from a software design perspective, it is unusable. In one
of the two classes within the entire program, for example, there is a method called “run” that is over
1000 lines long, (or, according to a SLOC counter, about 550 lines without comments). The method
“run” encapsulates building the GUI and its every component, defining all action listeners in their
entirety with anonymous class definitions, managing multiple threads, handling data validation from
Dropbox, making numerous calls to Swing, Dropbox, AWT, and ImageJ libraries, building and
representing the file tree from Dropbox, determining the operating system of the user, and probably
If anyone ever wants to build off or further develop MyCloudJ, refactoring is a must. No
further work could possibly get around that. </p></blockquote>

<p>Before starting to implement the functionality for iRODS, a lot of refactoring work was done. This work also continued while adding iRODS features. I will present the re-factoring challenges in this separate chapter, trying to isolate the presentation of the functionality from the presentation of the re-factoring. Stay tunned!</p>

<h3>
<a id="week-1" class="anchor" href="#week-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Week 1</h3>

<p><u>Deliverable 1:</u> Plugin with a simple GUI, asking for iRODS credentials. The plugin can create a session with the iRODS server and display a successful/not successful connection message.  </p>

<p>As can be observed from the below picture, I kept the GUI from Atin's project and modified just the login box, by providing the user with text inputs for entering the credentials. The user can switch between Dropbox and iRODS login using a Radio Button.</p>

<p>iRODS Login Screen<img src="images/screen_login_irods.png"></a></p>

<p>Code implementing the login part can be found in the login method from the rods_backend package. Every cloud plugin should implement a login method and that's the reason for making the login method an operation in the CloudOperations interface. </p>

<pre><code>
import org.irods.jargon.core.connection.IRODSAccount;
import org.irods.jargon.core.connection.IRODSProtocolManager;
import org.irods.jargon.core.connection.IRODSSession;
import org.irods.jargon.core.connection.IRODSSimpleProtocolManager;
import org.irods.jargon.core.exception.JargonException;
import org.irods.jargon.core.pub.IRODSAccessObjectFactory;
import org.irods.jargon.core.pub.IRODSAccessObjectFactoryImpl;
import org.irods.jargon.core.pub.io.IRODSFile;

public void login() throws CloudException {    
	String error;    
	IRODSProtocolManager connectionManager;   
	IRODSAccount account;   
	IRODSAccessObjectFactory accessObjectFactory;

	try {
		connectionManager = IRODSSimpleProtocolManager.instance();
		session = IRODSSession.instance(connectionManager);
		account = new IRODSAccount(host, port, user, password,
				homeDirectoryPath, zone, res);
		accessObjectFactory = IRODSAccessObjectFactoryImpl
				.instance(session);
		irodsFileFactory = accessObjectFactory.getIRODSFileFactory(account);

		buildHomePath();
		userIsLogged = true;
	} catch (JargonException e) {
		error = "Error login to iRODS";
		throw (new CloudException(error));
	}
}
</code></pre>

<p>As can be seen from the imports used,  the communication with the iRODS server was done using the <a href="https://github.com/DICE-UNC/jargon">Jargon API</a>, version 4.0.2.1. I created a jar (jargon-core-4.0.2.1-SNAPSHOT-jar-with-dependencies.jar) with the Jargon functionality and placed it in the libs folder then I linked my project against this jar.
A detailed explanation with all the fields used for the connection can be found <a href="https://github.com/DICE-UNC/jargon/wiki/Managing-connections">here</a>, but the field that we are intersted in is <i>irodsFileFactory</i>. This is the handler which will be used for reading/writing iRODS files from the cloud server. </p>

<p><u>iRODS server setup:</u> My changes were tested using a Virtual Box machine where I installed iRODS. The proposal of my mentors was to setup a public VM for easier testing. They provide me this machine and I installed iRODS on it. The problem is that I can't use the default listening port for iRODS (1247) because is not opened yet. Also, modifying the iRODS server to listen on port 80 (which is open) gave me an <a href="files/error_log">error</a>. We'll find a solution next week. </p>

<h3>
<a id="week-2" class="anchor" href="#week-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Week 2</h3>

<p><u>Deliverable 2:</u> Plugin wih the capability to browse the local file system and the remote iRODS file system.  </p>

<p>After a successful login to the iRODS server, input elements (RadioButton, JButton) from the right side of the main frame (iRODS Tasks) are activated:
<img src="images/active_right_frame.png"></p>

<p> The "Browse" buttons from the right side can be used for searching files either on the local file system or on the remote cloud file system, depending on the selected RadioButton (Upload/Download). First image illustrates the window for browsing files on the cloud filesystem while the second image shows the window for browsing files on the local file system: </p>

<p><img src="images/browse_cloud.png">&nbsp;&nbsp;&nbsp;<img src="images/browse_local.png"></p>


<p>UMLs describing the browsing functionality are displayed in the below figure. In order to separate the functionality between browsing trees, I created two distinct classes: 
<ul>
<li><p>CloudFileTree - implements methods for browsing the cloud file system. In order to make this class easy extendable to another cloud file system, the constructor of CloudFileTree receives as parameter a CloudOperations handler. In this way, CloudFileTree can be used to browse the file system for any cloud service which implements the CloudOperations interface, more specific, the listFiles method which creates a list with CloudFiles from a specific path. In my program, the CloudFileTree is used to browse the iRODS file system by implementing the back end communication with the iRODS server in the RodsOperations class but the CloudFileTree can be easy extended to browse the Dropbox filesystem if back end communication with Dropbox implements the CloudOperations class.<p>
<p>The basic principle from this class is very simple: every time the user clicks the Expand button, the selected node is expanded with a list of CloudFiles by calling the listFiles method. It's worth mentioning that the listFiles method is the only method used from the cloud handler.<p>

 </li>
<li>LocalFileTree - implements methods for browsing the local file system. This class is very simple because it uses the built-in ImageJ file browser. </li>
</ul>

MyCloudJ_ class just calls methods for drawing the file selection window and afterwards, it assigns ActionListeners for the JButtons inside these windows. Specific browsing processing is done inside those CloudFileTree and LocalFileTree.
  </p>
<p><img src="images/uml_browsing.png"></p>

<p><u>Server setup:</u> My mentors opened the port 1247 on the remote VM and I successfully tested my work. The main problem that I encountered was that the default resource specified at login didn't exist on the iRODS server and I got some errors while uploading files. Solved this problem by not specfing a default resource. The iRODS community helped me to solve the<a href="https://groups.google.com/forum/#!topic/irod-chat/dOIOrhMnbSw"> problem.</a></p>







      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/dorugucea91/CloudPlugin">CloudPlugin</a> is maintained by <a href="https://github.com/dorugucea91">dorugucea91</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

